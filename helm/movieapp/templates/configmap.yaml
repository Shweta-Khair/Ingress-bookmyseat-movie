{{- if .Values.initScripts.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.initScripts.name }}
  namespace: {{ .Values.namespace.name }}
data:
  V1__Create_movies_and_showtimes_tables.sql: |
    -- Create movies table
    CREATE TABLE movies (
        id BIGINT AUTO_INCREMENT PRIMARY KEY,
        title VARCHAR(255) NOT NULL,
        description TEXT,
        duration_minutes INT NOT NULL,
        genre VARCHAR(100),
        language VARCHAR(50),
        release_date DATE,
        created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6),
        updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),
        INDEX idx_genre (genre),
        INDEX idx_language (language)
    );

    -- Create showtimes table
    CREATE TABLE showtimes (
        id BIGINT AUTO_INCREMENT PRIMARY KEY,
        movie_id BIGINT NOT NULL,
        show_date_time DATETIME NOT NULL,
        theater VARCHAR(100) NOT NULL,
        available_seats INT NOT NULL,
        created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6),
        updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),
        FOREIGN KEY (movie_id) REFERENCES movies(id) ON DELETE CASCADE,
        INDEX idx_movie_id (movie_id),
        INDEX idx_show_date_time (show_date_time),
        INDEX idx_theater (theater)
    );
  V2__Insert_sample_data.sql: |
    -- Insert sample movies and showtimes from the migration script
    INSERT INTO movies (title, description, duration_minutes, genre, language, release_date) VALUES
    ('Inception', 'A mind-bending thriller about dreams within dreams', 148, 'Sci-Fi', 'English', '2010-07-16'),
    ('The Dark Knight', 'Batman faces the Joker in this epic superhero film', 152, 'Action', 'English', '2008-07-18'),
    ('Interstellar', 'A team of explorers travel through a wormhole in space', 169, 'Sci-Fi', 'English', '2014-11-07'),
    ('The Godfather', 'The aging patriarch of an organized crime dynasty transfers control', 175, 'Drama', 'English', '1972-03-24'),
    ('Pulp Fiction', 'The lives of two mob hitmen, a boxer, and others intertwine', 154, 'Crime', 'English', '1994-10-14'),
    ('Dangal', 'A biographical sports drama about wrestler Mahavir Singh Phogat', 161, 'Biography', 'Hindi', '2016-12-23'),
    ('3 Idiots', 'Two friends are searching for their long lost companion', 170, 'Comedy', 'Hindi', '2009-12-25'),
    ('Avengers: Endgame', 'The Avengers assemble once more to reverse Thanos snap', 181, 'Action', 'English', '2019-04-26');
{{- end }}

